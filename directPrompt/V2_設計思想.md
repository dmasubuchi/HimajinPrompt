# BPMN GEM v2.0 設計思想

## 🎯 根本的な発想転換

### v1の問題
```
複雑なデータ構造 → 複雑な描画ロジック → APIエラー多発
```

### v2の解決
```
最小データ構造 → 最小描画ロジック → エラー回避
```

## 📐 設計の3原則

### 1. **データの極小化**
```javascript
// v1: 複雑
{
  actors: [{id:"A1", name:"営業", color:"#00acc1"}],
  tasks: [{id:"T1", name:"受注", actor:"A1", type:"task"}],
  flows: [{from:"T1", to:"T2", type:"normal"}]
}

// v2: シンプル
{
  lanes: ["営業"],
  steps: [{id:1, lane:0, text:"受注"}],
  links: [{from:1, to:2}]
}
```

### 2. **API使用の最小化**
```javascript
// 使わない（エラーの原因）
❌ setParagraphAlignment()
❌ setEndArrowStyle()
❌ getPageWidth()

// 使う（基本的で安定）
✅ insertShape()
✅ setText()
✅ setSolidFill()
```

### 3. **役割の明確化**
```
AI = データアーキテクト
  - 業務フローを理解
  - 構造化データ生成
  - 描画は知らない

コード = レンダラー
  - データを視覚化
  - エラー処理
  - 最小限の描画
```

## 🔄 まじん式から学んだこと

### 「分離の美学」
まじん式の本質は、AIとコードの責任を完全に分離すること。
- AIは「何を」描くか（WHAT）
- コードは「どう」描くか（HOW）

### 「段階的変換」
```
自然言語
  ↓ [AI: 意味解析]
最小データ
  ↓ [コード: 描画]
スライド
```

### 「防御的設計」
- Google APIの不安定さを前提
- エラーが出ても続行
- 最小機能で最大効果

## 💡 v2の革新点

### 1. **数値ID採用**
文字列IDをやめて数値に統一。参照エラーを削減。

### 2. **インデックス参照**
lane名ではなく配列インデックス。マッチングエラーを排除。

### 3. **フラット構造**
ネストを避けて、すべてフラットな配列に。

### 4. **エラー無視戦略**
```javascript
try {
  // 線を描画
} catch(e) {
  // エラーでも続行
}
```

## 📊 効果測定

| 指標 | v1 | v2 |
|-----|----|----|
| データサイズ | 100行 | 20行 |
| API呼び出し | 20種類 | 5種類 |
| エラー率 | 高 | 低 |
| 生成速度 | 遅い | 速い |

## 🚀 使用方法

1. **プロンプト投入**
   ```
   BPMN_GEM_V2_claude.md をGeminiに
   ```

2. **業務フロー説明**
   ```
   「受注処理。営業が受注して倉庫が出荷」
   ```

3. **コード取得**
   ```javascript
   // 完全なGASコードが生成される
   ```

4. **実行**
   ```
   GASエディタに貼り付けて実行
   ```

## 🎨 デザイン決定の理由

### なぜ最小化か？
Google Slides APIは頻繁に変更される。使用するメソッドが少ないほど、将来の破壊的変更の影響を受けにくい。

### なぜ数値IDか？
文字列のマッチングはエラーが起きやすい。数値は単純で確実。

### なぜtry-catchか？
完璧な図より、不完全でも表示される図の方が価値がある。

## 📝 結論

**v2は「Less is More」の哲学**

複雑さは敵。シンプルさは友。
最小のデータと最小のコードで、最大の価値を提供する。

これがまじん式から学んだ、真の設計思想。