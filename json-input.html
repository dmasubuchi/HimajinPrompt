<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ã²ã¾ã˜ã‚“å¼BPMN - JSONã§ä¸€ç™ºç”Ÿæˆ</title>
  <style>
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 30px;
    }

    h1 {
      color: #333;
      font-size: 24px;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .sample-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .sample-btn {
      background: #4285f4;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
      font-size: 14px;
    }

    .sample-btn:hover {
      background: #357ae8;
    }

    textarea {
      width: 100%;
      height: 400px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      box-sizing: border-box;
      background: #fafafa;
    }

    textarea:focus {
      outline: none;
      border-color: #4285f4;
      background: white;
    }

    .button-group {
      text-align: center;
      margin-top: 20px;
    }

    .generate-btn {
      background: #0f9d58;
      color: white;
      border: none;
      padding: 12px 40px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }

    .generate-btn:hover {
      background: #0b8043;
    }

    .result {
      margin-top: 30px;
      padding: 20px;
      background: #e8f5e9;
      border-radius: 4px;
      display: none;
      text-align: center;
    }

    .result.show {
      display: block;
    }

    .result a {
      color: #0f9d58;
      font-size: 16px;
      font-weight: bold;
    }

    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      display: none;
    }

    .error.show {
      display: block;
    }

    .loading {
      text-align: center;
      display: none;
      margin-top: 20px;
    }

    .loading.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ ã²ã¾ã˜ã‚“å¼BPMN - JSONã§ä¸€ç™ºç”Ÿæˆ</h1>
    <p class="subtitle">JSONã‚’è²¼ã‚Šä»˜ã‘ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ï¼</p>

    <div class="sample-buttons">
      <button class="sample-btn" onclick="loadSample1()">ğŸ“‹ ã‚µãƒ³ãƒ—ãƒ«1ï¼ˆæœ€å°ï¼‰</button>
      <button class="sample-btn" onclick="loadSample2()">ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«2ï¼ˆæ¨™æº–ï¼‰</button>
      <button class="sample-btn" onclick="loadSample3()">ğŸ¨ ã‚µãƒ³ãƒ—ãƒ«3ï¼ˆè©³ç´°ï¼‰</button>
    </div>

    <textarea id="jsonInput" placeholder='JSONã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ä¾‹ï¼š
{
  "processInfo": {
    "name": "å—æ³¨å‡¦ç†ãƒ•ãƒ­ãƒ¼"
  },
  "orientation": "both",
  "actors": [
    {"id": "A1", "name": "å–¶æ¥­éƒ¨"},
    {"id": "A2", "name": "å€‰åº«"}
  ],
  "tasks": [
    {"id": "T1", "name": "æ³¨æ–‡å—ä»˜", "actor": "A1"},
    {"id": "T2", "name": "åœ¨åº«ç¢ºèª", "actor": "A2"}
  ],
  "flows": [
    {"from": "T1", "to": "T2"}
  ]
}'></textarea>

    <div class="button-group">
      <button class="generate-btn" onclick="generate()">ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆ</button>
    </div>

    <div class="loading" id="loading">
      â³ ç”Ÿæˆä¸­...
    </div>

    <div class="result" id="result">
      âœ… ç”Ÿæˆå®Œäº†ï¼<br><br>
      <a id="slideUrl" href="#" target="_blank">ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’é–‹ã</a>
    </div>

    <div class="error" id="error"></div>
  </div>

  <script>
    function generate() {
      const jsonText = document.getElementById('jsonInput').value.trim();

      if (!jsonText) {
        showError('JSONã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      let jsonData;
      try {
        jsonData = JSON.parse(jsonText);
      } catch (e) {
        showError('JSONã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“: ' + e.message);
        return;
      }

      document.getElementById('loading').classList.add('show');
      document.getElementById('result').classList.remove('show');
      document.getElementById('error').classList.remove('show');

      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .generateBPMNPresentationFromWeb(jsonData);
    }

    function onSuccess(result) {
      document.getElementById('loading').classList.remove('show');

      if (result.success) {
        document.getElementById('slideUrl').href = result.url;
        document.getElementById('slideUrl').textContent = result.url;
        document.getElementById('result').classList.add('show');
      } else {
        showError('ã‚¨ãƒ©ãƒ¼: ' + (result.error || 'ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ'));
      }
    }

    function onFailure(error) {
      document.getElementById('loading').classList.remove('show');
      showError('ã‚¨ãƒ©ãƒ¼: ' + error);
    }

    function showError(message) {
      document.getElementById('error').textContent = message;
      document.getElementById('error').classList.add('show');
    }

    // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
    function loadSample1() {
      const sample = {
        "processInfo": {"name": "ã‚·ãƒ³ãƒ—ãƒ«ãƒ•ãƒ­ãƒ¼"},
        "orientation": "both",
        "actors": [
          {"id": "A1", "name": "å–¶æ¥­"},
          {"id": "A2", "name": "å€‰åº«"}
        ],
        "tasks": [
          {"id": "T1", "name": "å—æ³¨", "actor": "A1"},
          {"id": "T2", "name": "å‡ºè·", "actor": "A2"}
        ],
        "flows": [
          {"from": "T1", "to": "T2"}
        ]
      };
      document.getElementById('jsonInput').value = JSON.stringify(sample, null, 2);
    }

    function loadSample2() {
      const sample = {
        "processInfo": {"name": "å—æ³¨å‡¦ç†ãƒ•ãƒ­ãƒ¼"},
        "orientation": "both",
        "actors": [
          {"id": "A1", "name": "å–¶æ¥­éƒ¨"},
          {"id": "A2", "name": "å€‰åº«"},
          {"id": "A3", "name": "è³¼è²·éƒ¨"}
        ],
        "tasks": [
          {"id": "T1", "name": "æ³¨æ–‡å—ä»˜", "actor": "A1"},
          {"id": "T2", "name": "åœ¨åº«ç¢ºèª", "actor": "A2"},
          {"id": "T3", "name": "å‡ºè·å‡¦ç†", "actor": "A2"},
          {"id": "T4", "name": "ç™ºæ³¨ä¾é ¼", "actor": "A3"}
        ],
        "gateways": [
          {"id": "G1", "name": "åœ¨åº«æœ‰ç„¡", "type": "exclusive"}
        ],
        "flows": [
          {"from": "T1", "to": "T2"},
          {"from": "T2", "to": "G1"},
          {"from": "G1", "to": "T3", "condition": "åœ¨åº«ã‚ã‚Š"},
          {"from": "G1", "to": "T4", "condition": "åœ¨åº«ãªã—"}
        ]
      };
      document.getElementById('jsonInput').value = JSON.stringify(sample, null, 2);
    }

    function loadSample3() {
      const sample = {
        "processInfo": {
          "name": "è©³ç´°ãªå—æ³¨å‡¦ç†ãƒ•ãƒ­ãƒ¼",
          "description": "æ‰¿èªãƒ•ãƒ­ãƒ¼ä»˜ã"
        },
        "orientation": "both",
        "phases": [
          {"id": "phase1", "name": "å—æ³¨", "order": 1},
          {"id": "phase2", "name": "ç¢ºèª", "order": 2},
          {"id": "phase3", "name": "å‡¦ç†", "order": 3}
        ],
        "actors": [
          {"id": "A1", "name": "å–¶æ¥­éƒ¨"},
          {"id": "A2", "name": "å€‰åº«"},
          {"id": "A3", "name": "è³¼è²·éƒ¨"},
          {"id": "A4", "name": "çµŒç†éƒ¨"}
        ],
        "tasks": [
          {"id": "T1", "name": "æ³¨æ–‡å—ä»˜", "actor": "A1", "phase": "phase1"},
          {"id": "T2", "name": "ä¸ä¿¡ãƒã‚§ãƒƒã‚¯", "actor": "A4", "phase": "phase2"},
          {"id": "T3", "name": "åœ¨åº«ç¢ºèª", "actor": "A2", "phase": "phase2"},
          {"id": "T4", "name": "å‡ºè·å‡¦ç†", "actor": "A2", "phase": "phase3"},
          {"id": "T5", "name": "ç™ºæ³¨ä¾é ¼", "actor": "A3", "phase": "phase3"},
          {"id": "T6", "name": "è«‹æ±‚æ›¸ç™ºè¡Œ", "actor": "A4", "phase": "phase3"}
        ],
        "gateways": [
          {"id": "G1", "name": "ä¸ä¿¡OK?", "type": "exclusive"},
          {"id": "G2", "name": "åœ¨åº«æœ‰ç„¡", "type": "exclusive"}
        ],
        "flows": [
          {"from": "T1", "to": "T2"},
          {"from": "T2", "to": "G1"},
          {"from": "G1", "to": "T3", "condition": "æ‰¿èª"},
          {"from": "T3", "to": "G2"},
          {"from": "G2", "to": "T4", "condition": "åœ¨åº«ã‚ã‚Š"},
          {"from": "G2", "to": "T5", "condition": "åœ¨åº«ãªã—"},
          {"from": "T4", "to": "T6"}
        ]
      };
      document.getElementById('jsonInput').value = JSON.stringify(sample, null, 2);
    }

    // åˆæœŸè¡¨ç¤ºã§ã‚µãƒ³ãƒ—ãƒ«1ã‚’èª­ã¿è¾¼ã¿
    window.onload = function() {
      loadSample1();
    };
  </script>
</body>
</html>