<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ひまじん式BPMN - JSONで一発生成</title>
  <style>
    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 30px;
    }

    h1 {
      color: #333;
      font-size: 24px;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .sample-buttons {
      text-align: center;
      margin-bottom: 20px;
    }

    .sample-btn {
      background: #4285f4;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 0 5px;
      font-size: 14px;
    }

    .sample-btn:hover {
      background: #357ae8;
    }

    textarea {
      width: 100%;
      height: 400px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      box-sizing: border-box;
      background: #fafafa;
    }

    textarea:focus {
      outline: none;
      border-color: #4285f4;
      background: white;
    }

    .button-group {
      text-align: center;
      margin-top: 20px;
    }

    .generate-btn {
      background: #0f9d58;
      color: white;
      border: none;
      padding: 12px 40px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }

    .generate-btn:hover {
      background: #0b8043;
    }

    .result {
      margin-top: 30px;
      padding: 20px;
      background: #e8f5e9;
      border-radius: 4px;
      display: none;
      text-align: center;
    }

    .result.show {
      display: block;
    }

    .result a {
      color: #0f9d58;
      font-size: 16px;
      font-weight: bold;
    }

    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      display: none;
    }

    .error.show {
      display: block;
    }

    .loading {
      text-align: center;
      display: none;
      margin-top: 20px;
    }

    .loading.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎯 ひまじん式BPMN - JSONで一発生成</h1>
    <p class="subtitle">JSONを貼り付けてボタンを押すだけ！</p>

    <div class="sample-buttons">
      <button class="sample-btn" onclick="loadSample1()">📋 サンプル1（最小）</button>
      <button class="sample-btn" onclick="loadSample2()">📊 サンプル2（標準）</button>
      <button class="sample-btn" onclick="loadSample3()">🎨 サンプル3（詳細）</button>
    </div>

    <textarea id="jsonInput" placeholder='JSONを貼り付けてください。例：
{
  "processInfo": {
    "name": "受注処理フロー"
  },
  "orientation": "both",
  "actors": [
    {"id": "A1", "name": "営業部"},
    {"id": "A2", "name": "倉庫"}
  ],
  "tasks": [
    {"id": "T1", "name": "注文受付", "actor": "A1"},
    {"id": "T2", "name": "在庫確認", "actor": "A2"}
  ],
  "flows": [
    {"from": "T1", "to": "T2"}
  ]
}'></textarea>

    <div class="button-group">
      <button class="generate-btn" onclick="generate()">スライド生成</button>
    </div>

    <div class="loading" id="loading">
      ⏳ 生成中...
    </div>

    <div class="result" id="result">
      ✅ 生成完了！<br><br>
      <a id="slideUrl" href="#" target="_blank">スライドを開く</a>
    </div>

    <div class="error" id="error"></div>
  </div>

  <script>
    function generate() {
      const jsonText = document.getElementById('jsonInput').value.trim();

      if (!jsonText) {
        showError('JSONを入力してください');
        return;
      }

      let jsonData;
      try {
        jsonData = JSON.parse(jsonText);
      } catch (e) {
        showError('JSONの形式が正しくありません: ' + e.message);
        return;
      }

      document.getElementById('loading').classList.add('show');
      document.getElementById('result').classList.remove('show');
      document.getElementById('error').classList.remove('show');

      google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .generateBPMNPresentationFromWeb(jsonData);
    }

    function onSuccess(result) {
      document.getElementById('loading').classList.remove('show');

      if (result.success) {
        document.getElementById('slideUrl').href = result.url;
        document.getElementById('slideUrl').textContent = result.url;
        document.getElementById('result').classList.add('show');
      } else {
        showError('エラー: ' + (result.error || '生成に失敗しました'));
      }
    }

    function onFailure(error) {
      document.getElementById('loading').classList.remove('show');
      showError('エラー: ' + error);
    }

    function showError(message) {
      document.getElementById('error').textContent = message;
      document.getElementById('error').classList.add('show');
    }

    // サンプルデータ
    function loadSample1() {
      const sample = {
        "processInfo": {"name": "シンプルフロー"},
        "orientation": "both",
        "actors": [
          {"id": "A1", "name": "営業"},
          {"id": "A2", "name": "倉庫"}
        ],
        "tasks": [
          {"id": "T1", "name": "受注", "actor": "A1"},
          {"id": "T2", "name": "出荷", "actor": "A2"}
        ],
        "flows": [
          {"from": "T1", "to": "T2"}
        ]
      };
      document.getElementById('jsonInput').value = JSON.stringify(sample, null, 2);
    }

    function loadSample2() {
      const sample = {
        "processInfo": {"name": "受注処理フロー"},
        "orientation": "both",
        "actors": [
          {"id": "A1", "name": "営業部"},
          {"id": "A2", "name": "倉庫"},
          {"id": "A3", "name": "購買部"}
        ],
        "tasks": [
          {"id": "T1", "name": "注文受付", "actor": "A1"},
          {"id": "T2", "name": "在庫確認", "actor": "A2"},
          {"id": "T3", "name": "出荷処理", "actor": "A2"},
          {"id": "T4", "name": "発注依頼", "actor": "A3"}
        ],
        "gateways": [
          {"id": "G1", "name": "在庫有無", "type": "exclusive"}
        ],
        "flows": [
          {"from": "T1", "to": "T2"},
          {"from": "T2", "to": "G1"},
          {"from": "G1", "to": "T3", "condition": "在庫あり"},
          {"from": "G1", "to": "T4", "condition": "在庫なし"}
        ]
      };
      document.getElementById('jsonInput').value = JSON.stringify(sample, null, 2);
    }

    function loadSample3() {
      const sample = {
        "processInfo": {
          "name": "詳細な受注処理フロー",
          "description": "承認フロー付き"
        },
        "orientation": "both",
        "phases": [
          {"id": "phase1", "name": "受注", "order": 1},
          {"id": "phase2", "name": "確認", "order": 2},
          {"id": "phase3", "name": "処理", "order": 3}
        ],
        "actors": [
          {"id": "A1", "name": "営業部"},
          {"id": "A2", "name": "倉庫"},
          {"id": "A3", "name": "購買部"},
          {"id": "A4", "name": "経理部"}
        ],
        "tasks": [
          {"id": "T1", "name": "注文受付", "actor": "A1", "phase": "phase1"},
          {"id": "T2", "name": "与信チェック", "actor": "A4", "phase": "phase2"},
          {"id": "T3", "name": "在庫確認", "actor": "A2", "phase": "phase2"},
          {"id": "T4", "name": "出荷処理", "actor": "A2", "phase": "phase3"},
          {"id": "T5", "name": "発注依頼", "actor": "A3", "phase": "phase3"},
          {"id": "T6", "name": "請求書発行", "actor": "A4", "phase": "phase3"}
        ],
        "gateways": [
          {"id": "G1", "name": "与信OK?", "type": "exclusive"},
          {"id": "G2", "name": "在庫有無", "type": "exclusive"}
        ],
        "flows": [
          {"from": "T1", "to": "T2"},
          {"from": "T2", "to": "G1"},
          {"from": "G1", "to": "T3", "condition": "承認"},
          {"from": "T3", "to": "G2"},
          {"from": "G2", "to": "T4", "condition": "在庫あり"},
          {"from": "G2", "to": "T5", "condition": "在庫なし"},
          {"from": "T4", "to": "T6"}
        ]
      };
      document.getElementById('jsonInput').value = JSON.stringify(sample, null, 2);
    }

    // 初期表示でサンプル1を読み込み
    window.onload = function() {
      loadSample1();
    };
  </script>
</body>
</html>